<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Notice: re-connecting soon after disconnection</title>
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" href="../../style.css" type="text/css">
</head>
<body>

<h1>NOTICE: Immediately re-connect the server after disconnection</h1>
<p>
ホストとの接続を終了後、すぐにconnectコマンドで新しい接続を開始する場合、以下のような問題が発生する場合がある。例えば、
</p>

<pre class="macro-example">
; Sending the exit command to disconnect the remote host.
sendln "exit"

; Re-connect the remote host.
connect "server"
</pre>

<p>
このマクロは大抵の場合はうまく動かない。<br>
sendln "exit"でexitコマンドを送ってからホストが接続を切断してくるのに少しタイムラグが発生する。<br>
マクロはこのタイムラグの間に次のconnectコマンドを実行する。<br>
しかしホストとの接続がまだ終了していないため、connectコマンドは既に接続しているとみなして何も行わない。
</p>

<p>
この問題を回避するには、以下のようにホストとの接続が終了したのを確認してからconnectコマンドを実行するようにする。
</p>

<pre class="macro-example">
; Sends the exit command and prompts the server disconnection.
sendln "exit"

do
	; Waits 10 msec.
	mpause 10
	; Confirms the connection status.
	testlink
; Repeats if TeraTerm connects the server. See <a href="../command/testlink.html">result is 2</a>.
loop while result = 2

; Re-connects a new connection.
connect "server"
</pre>

<p>
また、<a href="../../menu/setup-tcpip.html#autowinclose">切断後自動的にウィンドウを閉じる設定</a>の場合、以下のようにunlinkコマンドでTera Termを切り離してもよい。
</p>

<pre class="macro-example">
; Sends the exit command and prompts the server disconnection.
sendln "exit"

; Unlinks TeraTerm.
unlink

; Re-connects a new connection.
connect "server"
</pre>

</body>
</html>
