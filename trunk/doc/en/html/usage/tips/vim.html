<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Tips on vim</title>
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="stylesheet" href="../../style.css" type="text/css">
</head>
<body>

<h1>Tips on vim</h1>
<h1>VIM Control Sequence Examples</h1>
<p>
When a user uses the control sequence, the remote host can control the Tera Term behavior. 
The VIM procedure for using the control sequence is described below.
</p>

<h2><a name="CursorStyle">Changing cursor shape on entering and leaving into insert mode</a></h2>
<!--
<p>
Tera Term では、以下のカーソル表示状態変更制御シーケンスに対応しています。
</p>

<table border="1">
  <tr> <th>略称</th> <th>シーケンス</th> <th>機能</th> </tr>

  <tr> <td rowspan="2">DECTCEM</td>
       <td>ESC [ ? 25 h</td> <td>カーソルを表示状態にする</td> </tr>
  <tr> <td>ESC [ ? 25 l</td> <td>カーソルを非表示状態にする</td> </tr>

  <tr> <td rowspan="7">DECSCUSR</td>
       <td>ESC SP 0 q</td> <td>カーソル形状を箱型で点滅状態にする</td> </tr>
  <tr> <td>ESC SP 1 q</td> <td>カーソル形状を箱型で点滅状態にする</td> </tr>
  <tr> <td>ESC SP 2 q</td> <td>カーソル形状を箱型で点灯(非点滅)状態にする</td> </tr>
  <tr> <td>ESC SP 3 q</td> <td>カーソル形状を下線で点滅状態にする</td> </tr>
  <tr> <td>ESC SP 4 q</td> <td>カーソル形状を下線で点灯(非点滅)状態にする</td> </tr>
  <tr> <td>ESC SP 5 q</td> <td>カーソル形状を縦線で点滅状態にする</td> </tr>
  <tr> <td>ESC SP 6 q</td> <td>カーソル形状を縦線で点灯(非点滅)状態にする</td> </tr>

  <tr> <td rowspan="2">WYSTCURM</td>
       <td>ESC [ 33 h</td> <td>カーソルを点灯(非点滅)状態にする</td> </tr>
  <tr> <td>ESC [ 33 l</td> <td>カーソルを点滅状態にする</td> </tr>

  <tr> <td rowspan="2">WYULCURM</td>
       <td>ESC [ 34 h</td> <td>カーソル形状を下線にする</td> </tr>
  <tr> <td>ESC [ 34 l</td> <td>カーソル形状を箱型にする</td> </tr>

  <tr> <td rowspan="2"> (AT&amp;T 610) </td>
       <td>ESC [ ? 12 l</td> <td>カーソルを点灯(非点滅)状態にする</td> </tr>
  <tr> <td>ESC [ ? 12 h</td> <td>カーソルを点滅状態にする</td> </tr>
</table>

<p>
これらの制御シーケンスを挿入モードに入る時 (t_SI 設定) および挿入モードから出る時 (t_EI 設定) に出力する事で、挿入モードでのカーソル形状を変更できます。<br>
例えば .vimrc に以下の設定を追加すると、挿入モードに入った時にカーソル形状が下線で点滅に、挿入モードから出た時に箱型で点滅に変わるようになります。
</p>

<pre class="macro-example">
let t_SI .= "\e[3 q"
let t_EI .= "\e[1 q"
</pre>

<p>注: DECTCEM <strong>以外</strong>の制御シーケンスを使うには、Additional Settings ダイアログの Control sequence タブに有る Cursor control sequence を on にする必要があります。(デフォルトは off)</p>
-->

<h2><a name="Bracketed">Bracketed Paste Mode</a></h2>
<h2><a name="Bracketed">Auto indent can be disabled on pasting from clipboard</a></h2>
<p>
Basically, the host application can not recognize the difference between the user input and pasting from clipboard. 
However, when a user uses the Bracketed Paste Mode as the xterm extension, the application can recognize its difference and a user can change the behavior of pasting from clipboard.
</p>

<p>
The vim configuration is described below. The following will use xterm's bracketed paste mode to make pasting automatically enable paste mode and insert mode. Also works fine in ~/.vimrc file.
</p>

<pre class="macro-example">
if &term == "xterm"
  let &t_ti .= "\e[?2004h"
  let &t_te .= "\e[?2004l"
  let &pastetoggle = "\e[201~"

  function XTermPasteBegin(ret)
    set paste
    return a:ret
  endfunction

  map &lt;special&gt; &lt;expr&gt; &lt;Esc&gt;[200~ XTermPasteBegin("0i")
  imap &lt;special&gt; &lt;expr&gt; &lt;Esc&gt;[200~ XTermPasteBegin("")
  cmap &lt;special&gt; &lt;Esc&gt;[200~ &lt;nop&gt;
  cmap &lt;special&gt; &lt;Esc&gt;[201~ &lt;nop&gt;
endif
</pre>

<h3>Bracketed Paste mode</h3>
<p>
The bracketed paste mode is the xterm extension feature. When this feature is enabled, the pasted text is bracketed with control sequences so that the program can differentiate the pasted text from typed-in text.<br>
The program will receive: ESC [ 200 ~, followed by the pasted text, followed by ESC [ 201 ~.
</p>


<h2><a name="IMEcontrol">Controlling IME</a></h2>

<p>
Tera Term can support the original sequence to control the IME behavior.
For example, A user can switch the IME status of enabling and disabling to use this control sequence.
</p>

<p>
When below contents is be added in the .vimrc file, the IME status is off after the insert mode exiting. Next, the IME status is on after the insert mode enabling.
</p>

<pre class="macro-example">
let &t_SI .= "\e[&lt;r"
let &t_EI .= "\e[&lt;s\e[&lt;0t"
let &t_te .= "\e[&lt;0t\e[&lt;s"
</pre>

<p>
NOTICE: You are recommended to configure the <a href="#AppESC">Delete wait time after ESC key is pushed in insert mode</a>.
</p>


<h2><a name="AppESC">Delete wait time after ESC key is pushed in insert mode</a></h2>
<p>
When the ESC key is pressed, Tera Term, xterm and other terminal emulator send the ESC(0x1b) key code. Also, when the cursor key and the function key is pushed, Tera Term sends the ESC key code.
Therefore, the host application can not recognize whether the ESC key is pressed. <br>
So, the vim waits for one second when the ESC key code is received to recognize what key is pressed. 
As a result, when a user presses the ESC key, the time for the insert mode exiting will be late for 1 second.
This behavior can not be affected by enabling <a href="#CursorStyle">Changing cursor shape on entering and leaving into insert mode</a> and <a href="#IMEcontrol">Controlling IME</a>.
</p>

<p>
Please use the Application Wheel Mode to resolve this problem.
When below contents is added in the .vimrc file, the insert mode is quickly exited after the ESC key is pressed.
</p>

<pre class="macro-example">
let &t_SI .= "\e[?7727h"
let &t_EI .= "\e[?7727l"
inoremap &lt;special&gt; &lt;Esc&gt;O[ &lt;Esc&gt;
</pre>

</body>
</html>
